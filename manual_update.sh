#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–æ—Ç–∞ –Ω–∞ VDS
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–≥–¥–∞ –∞–≤—Ç–æ–¥–µ–ø–ª–æ–π –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

echo "üöÄ –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Zenith Bot –Ω–∞ VDS..."

# –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ VDS –∏ –≤—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—ã
sshpass -p 'o*-?k*4UNaAU8p' ssh -o StrictHostKeyChecking=no root@92.51.22.201 << 'EOF'
    echo "üìç –ü–æ–¥–∫–ª—é—á–µ–Ω –∫ VDS"
    
    # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
    cd /opt/zenith-bot || { echo "‚ùå –ü–∞–ø–∫–∞ /opt/zenith-bot –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!"; exit 1; }
    
    echo "üì• –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è..."
    git fetch origin
    git reset --hard origin/main
    git pull origin main
    
    echo "üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
    npm install --production
    
    echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞..."
    pm2 restart zenith-bot || pm2 start ecosystem.config.js
    
    echo "üìä –°—Ç–∞—Ç—É—Å PM2:"
    pm2 status
    
    echo "üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏:"
    pm2 logs zenith-bot --lines 5 || echo "–õ–æ–≥–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã"
    
    echo "‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
EOF

echo "üéâ –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!"
