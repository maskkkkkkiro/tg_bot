# 🚀 Инструкция по развертыванию Zenith DLC Bot на VDS

## 📋 Что нужно сделать на сервере:

### 1. Скачать код с GitHub
```bash
cd /opt
git clone https://github.com/maskkkkkkiro/tg_bot.git zenith-bot
cd zenith-bot
```

### 2. Установить зависимости
```bash
npm install
```

### 3. Остановить старый бот (если запущен)
```bash
pm2 stop zenith-bot
pm2 delete zenith-bot
```

### 4. Запустить новый бот
```bash
# Способ 1: С ecosystem файлом (рекомендуется)
pm2 start ecosystem.config.js
pm2 save

# Способ 2: Обычная команда  
pm2 start index.js --name zenith-bot --mode fork -i 1
pm2 save
```

⚠️ **ВАЖНО**: Обязательно используйте `--mode fork`, НЕ cluster!

### 5. Проверить статус
```bash
pm2 status
pm2 logs zenith-bot --lines 20
```

## 🔧 Что исправлено в версии v7:

- ✅ **Улучшена обработка ошибок "user is deactivated"** - бот больше не будет падать от заблокированных пользователей
- ✅ **Исправлена обработка polling ошибок** - улучшена стабильность подключения к Telegram
- ✅ **Добавлена обработка unhandledRejection** - предотвращение падений от необработанных Promise
- ✅ **Улучшено логирование** - более информативные логи без спама
- ✅ **Повышена стабильность рассылок** - корректная обработка недоступных пользователей
- ✅ **Очищен проект** - удалены все лишние файлы, оставлены только необходимые

## 📊 Ожидаемый результат:
```
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ zenith-bot         │ fork     │ 0    │ online    │ 0%       │ 40mb     │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
```

**Обратите внимание**: `mode: fork` (НЕ cluster!)

После обновления вы должны увидеть в логах:
```
🤖 Telegram бот запущен!
📢 Канал для подписки: https://t.me/zenithdlc
👑 ID администратора: 7266075993
🐛 Чат поддержки: -4895236834
📺 Медиа партнерский чат: -4962158079
✅ Версия: FIXED_2025-08-03_v7 - Error Handling and Stability Fix
## 🔧 В логах должно быть:
```
🤖 Telegram бот запущен!
📢 Канал для подписки: https://t.me/zenithdlc
👑 ID администратора: 7266075993
🐛 Чат поддержки: -4895236834
📺 Медиа партнерский чат: -4962158079
✅ Версия: FIXED_2025-08-03_v8 - Conflict Prevention Fix
🔧 IPv4 конфигурация: Включена
⚡ Защита от спама: Активна
🛡️ Улучшенная обработка ошибок: Включена
🚨 Защита от конфликтов: Включена
```
⚡ Защита от спама: Активна
🛡️ Улучшенная обработка ошибок: Включена
```

## 🆘 Если что-то пошло не так:

1. Проверить логи: `pm2 logs zenith-bot`
2. Перезапустить: `pm2 restart zenith-bot`
3. Проверить статус: `pm2 status`

## 📞 Поддержка:
Если возникнут проблемы, создайте issue в GitHub репозитории.
